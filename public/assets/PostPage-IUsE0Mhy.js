import{u as S,j as e,J as P,q as T,c as E,b as $,f as u,a as C}from"./axiosInstance-B60J37ny.js";import{r as c}from"./vendor-CfxRerCp.js";import{T as R,t as f}from"./index-BgMHZnzL.js";import{H as B}from"./Header-DLvWApgL.js";import{S as I,Y as L}from"./YearFilterComponent-CahbW65Z.js";import{A as Y,R as _}from"./RssSubscribeLink-DXeeVZF2.js";import{R as D}from"./RecentActivityFeed-CfY4cXK0.js";import{B as M}from"./BlogPost-BOJTk0jN.js";import{P as q}from"./PortfolioLink-CxAvf9IN.js";import{N as z}from"./app-BZ86fJkl.js";import"./Spinner4-BhOwiG6x.js";import"./index-BwfBZVYM.js";function H({slug:r}){const[d,h]=c.useState([]),{theme:n}=S();c.useEffect(()=>{(async()=>{try{const m=[...await(await fetch(`/posts/${r}/suggested`)).json()];for(let a=m.length-1;a>0;a--){const p=Math.floor(Math.random()*(a+1));[m[a],m[p]]=[m[p],m[a]]}const b=Array.from(new Map(m.map(a=>[a.id,a])).values());h(b.slice(0,3))}catch(i){console.error("Error fetching suggested posts:",i)}})()},[r]);const x=o=>{o.currentTarget.onerror=null,o.currentTarget.src="/fallbackimage.jpg"};return d.length?e.jsxs("div",{className:"w-full flex flex-col items-center md:items-start !mt-6 md:!mt-8 !pt-4 md:!pt-6 border-t border-[#5800FF]/20 2xl:!ml-32 xl:w-4/5",children:[e.jsx("h3",{className:`font-semibold !text-lg lg:!text-2xl xl:!text-3xl ${n==="light"?"text-black":"text-white"} !mb-6 lg:!mb-14 sm:!pl-10`,children:"Suggested posts for you:"}),e.jsx("ul",{className:"flex flex-col !gap-4 w-full",children:d.map(o=>e.jsx("li",{className:"flex items-center bg-[#5800FF]/10 rounded-lg shadow !p-3 !pl-10 hover:shadow-lg transition-shadow w-full",children:e.jsxs(P,{href:`/posts/${o.slug}`,className:"flex items-center w-full",onClick:i=>window.scrollTo({top:0,behavior:"smooth"}),children:[e.jsx("img",{src:o.image_path?`/storage/${o.image_path}`:"/fallbackimage.jpg",alt:o.title,onError:x,className:"!w-14 !h-14 md:!w-16 md:!h-16 object-cover rounded-full bg-white/20 !mr-4",loading:"lazy"}),e.jsx("span",{className:`${n==="light"?"text-black":"text-white"} font-medium hover:underline text-sm md:text-base line-clamp-2 !ml-6`,children:o.title})]})},o.id))})]}):null}const ae=({post:r})=>{const{props:d}=T(),{theme:h}=S(),n=d.allPosts??{},{auth:x,currentTopic:o,topics:i,flash:t}=d,[m,b]=c.useState(i||[]),a=x==null?void 0:x.user,{confirm:p}=E(),j=a?!!a.is_admin:!1,[J,O]=c.useState(""),[U,G]=c.useState(!1),[w,v]=c.useState([]),{showAlert:g}=$(),N=Array.isArray(n)?n:(n==null?void 0:n.data)||[];c.useEffect(()=>{async function s(){try{const A=(await C.get(`api/comments/${r.id}`)).data.map(F=>({...F,createdAt:new Date(F.createdAt).toISOString()}));v(A)}catch(l){console.error("Failed to fetch comments",l),f.error("Failed to load comments")}}s()},[r.id]),c.useEffect(()=>{t!=null&&t.success&&g(t.success,"success"),t!=null&&t.error&&g(t.error,"error"),t!=null&&t.info&&g(t.info,"info")},[t]);const y=s=>{const l=new URLSearchParams;s&&l.append("topic",s),u.get("/",Object.fromEntries(l))},k=async s=>{try{await C.delete(`/api/comments/${s}`),v(w.filter(l=>l._id!==s)),f.success("Comment deleted successfully!")}catch(l){console.error("Failed to delete comment",l),f.error("Failed to delete comment. Please try again.")}};return e.jsx("div",{className:`min-h-160 ${h}`,children:e.jsxs("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[e.jsx(z,{}),e.jsx(B,{}),e.jsx("main",{className:"!p-4 md:!p-8 !gap-1",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 md:gap-30 custom-2xl-gap items-center lg:items-start lg:!pt-3",children:[e.jsx("aside",{className:"hidden lg:block w-full md:!w-2/3 xl:!w-2/3 xl:!ml-10 2xl:!ml-30 xl:max-w-120 xl:!mr-10 !mb-8 lg:!mb-0 mx-auto 2xl:!-mt-4",children:e.jsxs("div",{className:"lg:top-24 !space-y-4 md:!space-y-6 flexcontainer w-full lg:!w-80 xl:!w-120 bg-[var(--bg-primary)] lg:!mt-0 rounded-t-lg 2xl:!pt-4",children:[e.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4 2xl:!pl-6",children:[e.jsx("h3",{className:"font-semibold !mb-2",children:"About This Post"}),e.jsxs("p",{className:"opacity-80",children:["This is a blog post about ",(r.topic||"various topics").toLowerCase(),". You can find more posts on similar topics by using the search (type the name of the topic). You can also browse posts using the dropdown menu, archive page or the recommended posts section below each post. Clicking a tag on post returns all posts with the same tag."]})]}),e.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4 2xl:!pl-6",children:[e.jsx("h3",{className:"font-semibold !mb-2",children:"Actions"}),e.jsxs("ul",{className:"!space-y-1",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>u.visit("/"),className:"w-full text-left !px-2 !py-1 rounded hover:bg-[#5800FF]/20",children:"Back to All Posts"})}),j&&e.jsx("li",{children:e.jsx("button",{onClick:()=>u.visit(`/post/${r.id}/edit`),className:"w-full text-left !px-2 !py-1 rounded hover:bg-[#5800FF]/20",children:"Edit Post"})})]})]}),e.jsxs("div",{className:"bg-[#5800FF]/10 !pl-4 !pr-4 !pb-10 2xl:!pl-6 !mb-4 !pt-4 md:!pt-6",children:[i&&e.jsxs("div",{className:"!mb-8",children:[e.jsx("h3",{className:"font-semibold !mb-3",children:"Topics"}),e.jsx("div",{className:"!mb-2",children:e.jsx("button",{onClick:()=>y(null),className:`w-full text-left !px-2 !mb-1 !py-1 rounded ${o===null?"bg-[#5800FF] text-white":"hover:bg-[#5800FF]/20"}`,children:"All Topics"})}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.slice().sort((s,l)=>s.localeCompare(l)).map(s=>e.jsx("button",{onClick:()=>y(s),className:`text-center !px-2 !py-1 rounded border text-sm border-[#5800FF]/30 ${o===s?"bg-[#5800FF] text-white":"hover:bg-[#5800FF]/20"}`,children:s},s))})]}),e.jsx(I,{posts:N}),e.jsx(L,{posts:N}),e.jsx(Y,{}),e.jsx(D,{},"recent-activity-feed"),e.jsx(_,{}),e.jsx(q,{})]})]})}),e.jsx("div",{className:"flex flex-col items-center lg:-translate-x-14",children:e.jsxs("div",{className:"!space-y-6 md:!space-y-8",children:[e.jsx("h1",{className:"sr-only",children:r.title}),e.jsx(M,{post:r,comments:w,isAdmin:j,onReply:s=>{},onEdit:(s,l)=>{},onDelete:k,isPostPage:!0,showComments:!0}),r.slug?e.jsx(H,{slug:r.slug}):e.jsx("div",{children:"Check out my other posts!"})]})})]})}),e.jsx(R,{})]})})};export{ae as default};
