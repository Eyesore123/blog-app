import{S as D,r as d,b as A,j as e,a as E,f as k,q as _,e as U}from"./ConfirmationContext-B_AdGWYB.js";import I from"react-simplemde-editor";import{N as $}from"./Navbar-DgVBYgo-.js";import{H as M}from"./Header-Cfc4JRbS.js";import C from"react-markdown";import{a as S}from"./axiosInstance-CnLbWm-t.js";function L({onPreviewChange:l}){const{data:t,setData:n,post:m,processing:s,errors:r,reset:o}=D({title:"",content:"",topic:"",published:!0,image:null,tags:[]}),[p,g]=d.useState(""),[i,h]=d.useState(t.content),[v,j]=d.useState(""),{showAlert:F}=A(),c=d.useMemo(()=>({spellChecker:!1,placeholder:"Write your post content here..."}),[]);function x(a){h(a),n("content",a),l==null||l({title:t.title,content:a,image_url:p})}d.useEffect(()=>{if(t.image){const a=new FileReader;a.onload=()=>{const u=a.result;g(u),l==null||l({title:t.title,content:i,image_url:u})},a.readAsDataURL(t.image)}else g(""),l==null||l({title:t.title,content:i,image_url:""})},[t.image]);function N(a){var y;const u=(y=a.target.files)==null?void 0:y[0];if(!u)return n("image",null);if(!u.type.startsWith("image/")){console.error("Selected file is not an image");return}n("image",u)}function f(){const a=v.trim();a&&!t.tags.includes(a)&&n("tags",[...t.tags,a]),j("")}function b(a){n("tags",t.tags.filter(u=>u!==a))}function T(a){a.key==="Enter"&&(a.preventDefault(),f())}function w(a){if(a.preventDefault(),n("content",i),!t.title||!i||!t.topic){console.error("Missing required fields");return}if(t.image&&!t.image.type.startsWith("image/")){console.error("Image must be an image file");return}m("/posts",{onSuccess:()=>{o("title","content","topic","image","tags"),h(""),j(""),g(""),F("Post created successfully!","success")},onError:u=>{var y;console.error("Error creating post:",((y=u.response)==null?void 0:y.data)||u)}})}return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"!mb-6",children:"Create New Post:"}),e.jsxs("form",{onSubmit:w,encType:"multipart/form-data",className:"!space-y-4 !w-full !max-w-lg !mx-auto !flex !flex-col",children:[e.jsx("input",{type:"text",placeholder:"Post title",value:t.title,onChange:a=>n("title",a.target.value),className:"!w-full !p-2 !rounded !border !border-[#5800FF] !bg-[var(--bg-primary)]"}),r.title&&e.jsx("p",{className:"!text-red-600 !text-sm",children:r.title}),e.jsx("input",{type:"text",placeholder:"Topic (e.g., Web Development)",value:t.topic,onChange:a=>n("topic",a.target.value),className:"!w-full !p-2 !rounded !border !border-[#5800FF] !bg-[var(--bg-primary)]"}),r.topic&&e.jsx("p",{className:"!text-red-600 !text-sm",children:r.topic}),e.jsx(I,{value:i,onChange:x,options:c,className:"!w-full !p-2 !rounded !border !border-[#5800FF] !bg-[var(--bg-primary)]"}),r.content&&e.jsx("p",{className:"!text-red-600 !text-sm",children:r.content}),e.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"!w-full !p-2 !rounded !border !border-[#5800FF] !bg-[var(--bg-primary)]"}),r.image&&e.jsx("p",{className:"!text-red-600 !text-sm",children:r.image}),e.jsxs("div",{className:"!w-full",children:[e.jsx("label",{className:"!block !mb-1 !font-medium",children:"Tags"}),e.jsxs("div",{className:"!flex !gap-2",children:[e.jsx("input",{type:"text",placeholder:"Add a tag and press Enter",value:v,onChange:a=>j(a.target.value),onKeyDown:T,className:"!flex-grow !p-2 !rounded !border !border-[#5800FF] !bg-[var(--bg-primary)]"}),e.jsx("button",{type:"button",onClick:f,className:"!px-4 !py-2 !bg-[#5800FF] !text-white !rounded !hover:bg-[#E900FF] !transition-colors",children:"Add"})]}),r.tags&&e.jsx("p",{className:"!text-red-600 !text-sm",children:r.tags}),e.jsx("div",{className:"!mt-2 !flex !flex-wrap !gap-2",children:t.tags.map(a=>e.jsxs("div",{className:"!flex !items-center !bg-[#5800FF] !text-white !rounded !px-3 !py-1 !text-sm",children:[a,e.jsx("button",{type:"button",onClick:()=>b(a),className:"!ml-2 !font-bold !hover:text-gray-300","aria-label":`Remove ${a}`,children:"×"})]},a))})]}),e.jsx("button",{type:"submit",disabled:!t.title||!i||!t.topic||s,className:"!w-full !px-4 !py-2 !bg-[#5800FF] !text-white !rounded !hover:bg-[#E900FF] !disabled:opacity-50",children:s?"Creating...":"Create Post"})]})]})}function W({users:l=[]}){const{confirm:t}=E(),n=(s,r)=>{const o=r?"deactivate":"activate";t({title:r?"Deactivate User":"Activate User",message:r?"Are you sure you want to deactivate this user?":"Do you want to activate this user?",confirmText:o.charAt(0).toUpperCase()+o.slice(1),cancelText:"Cancel",type:r?"warning":"info"}).then(i=>{i&&k.post(`/admin/users/${s}/toggle`)})},m=s=>{t({title:"Delete User",message:"WARNING: This will permanently delete the user account. Proceed?",confirmText:"Delete",cancelText:"Cancel",type:"danger"}).then(r=>{r&&k.delete(`/admin/users/${s}`)})};return e.jsxs("div",{className:"w-full max-w-3xl mx-auto !mt-8 !mb-30",children:[e.jsx("h2",{className:"text-2xl font-bold !mb-4",children:"User Management"}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#5800FF]/10",children:[e.jsx("th",{className:"!p-2 border",children:"ID"}),e.jsx("th",{className:"!p-2 border",children:"Name"}),e.jsx("th",{className:"!p-2 border",children:"Email"}),e.jsx("th",{className:"!p-2 border",children:"Active?"}),e.jsx("th",{className:"!p-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"hover:opacity-80",children:[e.jsx("td",{className:"!p-2 border",children:s.id}),e.jsx("td",{className:"!p-2 border",children:s.name}),e.jsx("td",{className:"!p-2 border",children:s.email}),e.jsx("td",{className:"!p-2 border",children:s.is_active?"Yes":"No"}),e.jsxs("td",{className:"!p-2 border flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>n(s.id,s.is_active),className:`${s.is_active?"bg-yellow-400 hover:bg-yellow-500 text-black":"bg-green-500 hover:bg-green-600 text-white"} !px-2 !py-1 rounded`,children:s.is_active?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>m(s.id),className:"bg-red-500 text-white !px-2 !py-1 rounded hover:bg-red-600",children:"Delete"})]})]},s.id))})]})]})}function R({posts:l=[],previewPost:t,onDeletePost:n}){const[m,s]=d.useState(t);d.useEffect(()=>{s(t||null)},[t]);const r=o=>e.jsxs("article",{className:"!mb-6 !p-4 bg-[#5800FF]/5 rounded-lg border border-[#5800FF]/10 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:o.title||"(No title)"}),o.image_url?e.jsx("img",{src:o.image_url,alt:o.title||"Post image",className:"w-full max-w-md rounded !mb-10 !mt-10",onError:p=>{console.error(`Failed to load image: ${o.image_url}`),p.currentTarget.style.display="none"}}):e.jsx("p",{className:"text-gray-500 italic !mb-10",children:"No image available."}),e.jsx("div",{className:"text-sm opacity-80 !mb-4 whitespace-pre-wrap",children:e.jsx(C,{children:o.content||"(No content)"})}),n&&o.id!==void 0&&e.jsx("button",{onClick:()=>n(o.id),className:"mt-4 bg-red-600 text-white px-3 py-1 rounded hover:bg-red-800 text-sm",children:"Delete"})]},o.id||"preview");return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center max-w-screen-lg !mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold !mb-20 text-amber-300",children:m?"Live Preview":"Post Previews"}),m?r(m):l.length===0?e.jsx("p",{className:"text-gray-500",children:"No posts available."}):l.map(r)]})}const P=({allPosts:l})=>{const[t,n]=d.useState(null),[m,s]=d.useState(""),[r,o]=d.useState(!1),[p,g]=d.useState("fi"),[i,h]=d.useState(!1);d.useEffect(()=>{l.length>0&&n(l[0])},[l]),d.useEffect(()=>{s("")},[t]);async function v(){if(!t)return;o(!0);const c=`# ${t.title}

${t.content}`,x=await j(c,"en",p);x!==null&&s(x),o(!1)}async function j(c,x,N){var f;try{return(await S.post("/translate",{q:c,source:x,target:N})).data.translatedText}catch(b){return console.error("Translation failed:",((f=b==null?void 0:b.response)==null?void 0:f.data)||b.message),null}}async function F(){var w;if(!t)return;h(!0);const c=m.trim().split(`
`),x=c.find(a=>a.startsWith("#")),N=c.slice(x?1:0).join(`
`).trim(),f=x?x.replace(/^#\s*/,""):t.title,b=N,T={...t.translations||{},[p]:{title:f,content:b}};try{await S.put(`/posts/${t.id}/translation`,{translations:T}),alert("Translation saved successfully.")}catch(a){console.error("Saving translation failed:",((w=a==null?void 0:a.response)==null?void 0:w.data)||a.message),alert("Failed to save translation.")}h(!1)}return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 !p-6",children:[e.jsxs("aside",{className:"lg:col-span-3 bg-purple-50 border border-purple-100 !p-4 rounded-2xl shadow-sm max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold !mb-4 text-purple-700",children:"📚 Posts"}),e.jsx("ul",{className:"space-y-2",children:l.map(c=>e.jsx("li",{className:`cursor-pointer !px-3 !py-2 rounded-xl transition-all duration-200 font-medium ${(t==null?void 0:t.id)===c.id?"bg-purple-200 text-purple-900 shadow-inner":"hover:bg-purple-100 text-purple-800"}`,onClick:()=>n(c),role:"button",tabIndex:0,onKeyDown:x=>x.key==="Enter"&&n(c),children:c.title},c.id))})]}),e.jsx("main",{className:"lg:col-span-6 bg-white !p-6 rounded-2xl shadow-md overflow-y-auto max-h-[90vh]",children:t?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold !mb-4 text-gray-800",children:t.title}),t.image_url&&e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-auto rounded-lg !mb-5 shadow"}),e.jsx("div",{className:"prose prose-sm max-w-none !text-black !mb-4 !mt-4 dark:text-gray-200",children:e.jsx(C,{children:t.content})}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500 border-t !pt-2",children:["Created: ",t.created_at&&new Date(t.created_at).toLocaleString(),t.updated_at&&t.updated_at!==t.created_at&&e.jsxs("div",{className:"italic !mt-1",children:["Updated: ",new Date(t.updated_at).toLocaleString()]})]})]}):e.jsx("p",{className:"text-gray-500 italic",children:"Select a post to view details."})}),e.jsx("section",{className:"lg:col-span-3 bg-gray-50 border border-gray-100 !p-6 rounded-2xl shadow-sm flex flex-col",children:t?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold !mb-4 text-gray-700",children:"🌍 Translation"}),e.jsxs("select",{value:p,onChange:c=>g(c.target.value),className:"!mb-4 !p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-black",children:[e.jsx("option",{value:"fi",children:"Finnish"}),e.jsx("option",{value:"sv",children:"Swedish"}),e.jsx("option",{value:"de",children:"German"}),e.jsx("option",{value:"fr",children:"French"}),e.jsx("option",{value:"es",children:"Spanish"})]}),e.jsx("button",{onClick:v,disabled:r,className:"bg-purple-600 text-white !px-4 !py-2 rounded hover:bg-purple-700 disabled:opacity-50 !mb-4",children:r?"Translating...":"Translate"}),m?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full h-48 !p-2 rounded border text-black resize-none mb-2",value:m,onChange:c=>s(c.target.value)}),e.jsx("button",{onClick:F,disabled:i,className:"bg-green-600 text-white !px-4 !py-2 rounded hover:bg-green-700 disabled:opacity-50",children:i?"Saving...":"Save Translation"})]}):e.jsx("p",{className:"italic text-sm text-gray-500 opacity-70",children:"No translation yet."})]}):e.jsx("p",{className:"text-gray-500 italic",children:"Select a post to view its details."})})]})};function O(){var p,g;const{users:l,posts:t}=_().props;console.log("users:",l),console.log("posts:",t);const[n,m]=d.useState("create"),[s,r]=d.useState(null);d.useEffect(()=>{async function i(){try{const h=await S.get("/api/posts/initial");r(h.data)}catch(h){console.error("Failed to fetch initial post",h)}}i()},[]);const o=s&&(((p=s.title)==null?void 0:p.trim())||((g=s.content)==null?void 0:g.trim())||s.image_url);return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Admin Dashboard"}),e.jsx($,{}),e.jsx(M,{}),e.jsxs("div",{className:"!pt-20 !px-4 bg-[var(--bg-primary)] text-[var(--text-primary)] min-h-screen",children:[e.jsx("h1",{className:"text-3xl text-amber-300 font-bold text-center",children:"Admin Dashboard"}),e.jsx("p",{className:"text-lg text-gray-500 text-center !my-8",children:"Welcome to the admin dashboard."}),e.jsx("div",{className:"flex justify-center !mb-8 gap-4",children:["create","users","posts"].map(i=>e.jsx("button",{onClick:()=>m(i),className:`!px-4 !py-2 rounded ${n===i?"bg-amber-400 text-black":"bg-gray-700 text-white"}`,children:i==="create"?"Create Post":i==="users"?"User Management":"Posts & Translations"},i))}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-full",children:[n==="create"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{onPreviewChange:i=>r({id:0,...i})}),o&&e.jsx(R,{previewPost:s})]}),n==="users"&&e.jsx(W,{users:l}),n==="posts"&&e.jsx("div",{className:"w-full max-w-6xl",children:t&&t.length>0?e.jsx(P,{allPosts:t}):e.jsx("div",{className:"text-center text-gray-400",children:"No posts available"})})]})]})]})}export{O as default};
