import{q as y,u as v,a as w,r as l,b as F,j as s,f as n}from"./ConfirmationContext-DK_-GFGj.js";import{T as A}from"./index-DSz_xmn9.js";import{H as C}from"./Header-gtXVReKQ.js";import{S as P,Y as S}from"./YearFilterComponent-BJgsd0x-.js";import{A as T,a as $,R as k}from"./RssSubscribeLink-C7v8JYT1.js";import{B as E}from"./BlogPost-DTODCVhO.js";import{N as R}from"./Navbar-BhEc0PNi.js";import{a as g}from"./axiosInstance-Hn551h6z.js";import"react-helmet-async";import"react-markdown";import"./Spinner4-DhgEGjYq.js";const W=({post:o})=>{const{props:r}=y(),{theme:b}=v(),a=r.allPosts??{},{auth:i,topics:c,currentTopic:m}=r,d=i==null?void 0:i.user,{confirm:B}=w(),p=d?!!d.is_admin:!1,[D,H]=l.useState(""),[L,O]=l.useState(!1),[x,h]=l.useState([]),{showAlert:Y}=F(),f=Array.isArray(a)?a:(a==null?void 0:a.data)||[];l.useEffect(()=>{async function e(){try{const N=(await g.get(`api/comments/${o.id}`)).data.map(j=>({...j,createdAt:new Date(j.createdAt).toISOString()}));h(N)}catch(t){console.error("Failed to fetch comments",t)}}e()},[o.id]);const u=e=>{const t=new URLSearchParams;e&&t.append("topic",e),n.get("/",Object.fromEntries(t))};return s.jsx("div",{className:`min-h-160 ${b}`,children:s.jsxs("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[s.jsx(R,{}),s.jsx(C,{}),s.jsx("main",{className:"!p-4 md:!p-8 !gap-1",children:s.jsxs("div",{className:"w-full !mx-auto flex flex-col lg:flex-row md:!gap-10",children:[s.jsx("aside",{className:"w-full lg:!w-120 lg:!ml-30 !mb-8 lg:!mb-0",children:s.jsxs("div",{className:"lg:sticky lg:top-24 !space-y-4 md:!space-y-6 w-full lg:!w-80 xl:!w-120",children:[s.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4",children:[s.jsx("h3",{className:"font-semibold !mb-2",children:"About This Post"}),s.jsxs("p",{className:"opacity-80",children:["This is a blog post about ",o.topic||"various topics","."]})]}),s.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4",children:[s.jsx("h3",{className:"font-semibold !mb-2",children:"Actions"}),s.jsxs("ul",{className:"!space-y-1",children:[s.jsx("li",{children:s.jsx("button",{onClick:()=>n.visit("/"),className:"w-full text-left !px-2 !py-1 rounded hover:bg-[#5800FF]/20",children:"Back to All Posts"})}),p&&s.jsx("li",{children:s.jsx("button",{onClick:()=>n.visit(`/post/${o.id}/edit`),className:"w-full text-left !px-2 !py-1 rounded hover:bg-[#5800FF]/20",children:"Edit Post"})})]})]}),s.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4",children:[c&&s.jsxs("div",{className:"!mb-4",children:[s.jsx("h3",{className:"font-semibold !mb-2",children:"Topics"}),s.jsxs("ul",{className:"!space-y-1",children:[s.jsx("li",{children:s.jsx("button",{onClick:()=>u(null),className:`w-full text-left !px-2 !py-1 rounded ${m===null?"bg-[#5800FF] text-white":"hover:bg-[#5800FF]/20"}`,children:"All Topics"})}),c.map(e=>s.jsx("li",{children:s.jsx("button",{onClick:()=>u(e),className:`w-full text-left !px-2 !py-1 rounded ${m===e?"bg-[#5800FF] text-white":"hover:bg-[#5800FF]/20"}`,children:e})},e))]})]}),s.jsx(P,{posts:f}),s.jsx(S,{posts:f}),s.jsx(T,{}),s.jsx($,{}),s.jsx(k,{})]})]})}),s.jsx("div",{className:"lg:flex-1 flex flex-col items-center",children:s.jsx("div",{className:"!space-y-6 md:!space-y-8",children:s.jsx(E,{post:o,comments:x,isAdmin:p,onReply:e=>{console.log(`Reply to comment ${e}`)},onEdit:(e,t)=>{console.log(`Edit comment ${e} with new content: ${t}`)},onDelete:async e=>{try{await g.delete(`/api/comments/${e}`),h(x.filter(t=>t._id!==e))}catch(t){console.error("Failed to delete comment",t)}},isPostPage:!0})})})]})}),s.jsx(A,{})]})})};export{W as default};
