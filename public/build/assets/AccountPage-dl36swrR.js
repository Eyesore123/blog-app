import{u as H,j as e,f as c,a as M,q as S,b as O,c as q}from"./axiosInstance-B60J37ny.js";import{r as o}from"./vendor-CfxRerCp.js";import{N as z}from"./app-BZ86fJkl.js";import{H as B}from"./Header-DLvWApgL.js";import{S as G,Y as J}from"./YearFilterComponent-CahbW65Z.js";import{A as K,R as Q}from"./RssSubscribeLink-DXeeVZF2.js";import{R as V}from"./RecentActivityFeed-CfY4cXK0.js";function W({userId:l}){const[f,b]=o.useState([]),[p,x]=o.useState(!0),[g,m]=o.useState(null),{theme:h}=H();return o.useEffect(()=>{async function s(){var t,u;try{const i=await M.get(`/api/comments/user/${l}`);b(i.data),x(!1)}catch(i){console.error("Failed to fetch comments:",i),m(((u=(t=i.response)==null?void 0:t.data)==null?void 0:u.error)||"Failed to load comments."),x(!1)}}s()},[l]),p?e.jsx("p",{className:"text-gray-500 !mt-4",children:"Loading comments..."}):g?e.jsx("p",{className:"text-red-500 !mt-4",children:g}):e.jsxs("div",{className:"!mt-8 xl:!mt-6",children:[e.jsx("h2",{className:"text-xl font-bold !mb-8",children:"My Comments"}),f.length===0?e.jsx("p",{className:"text-gray-500",children:"You haven't posted any comments yet."}):e.jsx("ul",{className:"!space-y-4",children:f.map(s=>e.jsxs("li",{className:"border !p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["On post:"," ",e.jsx("span",{onClick:()=>s.post_slug?c.visit(`/post/${s.post_slug}`):null,className:"text-[#5800FF] hover:underline cursor-pointer",children:s.post_title||"Unknown Post"})]}),e.jsx("p",{className:`mt-1 ${h==="dark"?"text-white":"text-black"}`,children:s.content||"No content available"}),e.jsx("p",{className:`text-xs mt-1 ${h==="dark"?"text-white":"text-gray-400"}`,children:s.created_at?new Date(s.created_at).toLocaleString():"Unknown date"})]},s.id))})]})}function oe({user:l}){var P;const{props:f}=S();if(o.useEffect(()=>{(!l||l.is_anonymous)&&c.visit("/")},[l]),!l||l.is_anonymous)return null;const b=((P=f==null?void 0:f.allPosts)==null?void 0:P.data)||[],p=S().props.user,[x,g]=o.useState(p.email),[m,h]=o.useState(p.is_subscribed),[s,t]=o.useState(!1),u=o.useRef(null),i=o.useRef(null),w=o.useRef(null),[y,E]=o.useState(p.notify_comments??!1),[C,F]=o.useState(null),N=o.useRef(null),[j,_]=o.useState(p.name),{showAlert:a}=O(),{confirm:v}=q(),D=()=>{t(!0),c.post("/update-email",{email:x},{onSuccess:()=>{a("Email updated successfully!","success"),t(!1)},onError:()=>{a("Failed to update email","error"),t(!1)}})},U=()=>{const r=u.current.value??"",n=i.current.value??"",d=w.current.value??"";if(n.length<8){a("Password must be at least 8 characters long","error");return}if(n!==d){a("Passwords do not match","error");return}t(!0),c.post("/update-password",{current_password:r,password:n,password_confirmation:d},{onSuccess:()=>{a("Password updated successfully!","success"),t(!1),u.current&&(u.current.value=""),i.current&&(i.current.value=""),w.current&&(w.current.value="")},onError:()=>{a("Failed to update password","error"),t(!1)}})},R=()=>{t(!0);const r=m?"/account/unsubscribe-newsletter":"/account/subscribe-newsletter";c.post(r,{},{onSuccess:()=>{h(n=>!n),a(m?"Unsubscribed successfully!":"Subscribed successfully!","success"),t(!1)},onError:()=>{a("Failed to update subscription","error"),t(!1)}})},A=()=>{t(!0),c.post("/account/toggle-comment-notifications",{notify_comments:!y},{onSuccess:()=>{E(r=>!r),a("Comment notification preference updated!","success"),t(!1)},onError:()=>{a("Failed to update preference","error"),t(!1)}})},I=r=>{var d;const n=(d=r.target.files)==null?void 0:d[0];n&&F(URL.createObjectURL(n))},T=()=>{var d,k;const r=(k=(d=N.current)==null?void 0:d.files)==null?void 0:k[0];if(!r){a("Please select a file to upload.","error");return}const n=new FormData;n.append("profile_photo",r),t(!0),c.post("/account/upload-profile-image",n,{forceFormData:!0,onSuccess:()=>{a("Profile image updated successfully!","success"),t(!1),N.current&&(N.current.value=""),F(null)},onError:()=>{a("Failed to update profile image","error"),t(!1)}})},L=async()=>{await v({title:"Delete Profile Image",message:"Are you sure you want to delete your profile image? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger"})&&(t(!0),c.post("/account/delete-profile-image",{},{onSuccess:()=>{a("Profile image deleted successfully!","success"),t(!1)},onError:()=>{a("Failed to delete profile image","error"),t(!1)}}))},Y=()=>{if(!j.trim()){a("Name cannot be empty","error");return}t(!0),c.post("/update-name",{name:j},{onSuccess:()=>{a("Name updated successfully!","success"),t(!1)},onError:()=>{a("Failed to update name","error"),t(!1)}})},$=async()=>{if(!await v({title:"Delete Account",message:"Are you sure you want to delete your account? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger"}))return;const n=await v({title:"Remove Comments?",message:"Do you want to remove all your comments?",confirmText:"Yes, remove comments",cancelText:"No, keep comments",type:"warning"});t(!0),c.post("/account/delete",{user_id:l.id,remove_comments:n?"yes":"no"},{onSuccess:()=>{a("Account deleted successfully!","success"),t(!1),c.get("/")},onError:()=>{a("Failed to delete account","error"),t(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(B,{}),e.jsx("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:e.jsx("main",{className:"!p-4 md:!p-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 md:gap-6 custom-2xl-gap items-center lg:!items-start",children:[e.jsx("aside",{className:"hidden lg:block w-full md:!w-2/3 xl:!w-2/3 xl:!ml-20 2xl:!ml-30 xl:max-w-120 xl:!mr-10 !mb-8 lg:!mb-0 mx-auto",children:e.jsxs("div",{className:"lg:top-24 !space-y-4 md:!space-y-6 flexcontainer w-full lg:!w-80 xl:!w-120",children:[e.jsxs("div",{className:"rounded-lg !p-4 2xl:!pl-6",children:[e.jsx("h3",{className:"font-semibold !mb-2",children:"Account"}),e.jsx("p",{className:"opacity-80",children:"Here you can manage your account settings. You can update your email, password, and subscription status. If you don't need your account anymore, you can delete it."})]}),e.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4 2xl:!pl-6",children:[e.jsx(G,{posts:b}),e.jsx(J,{posts:b}),e.jsx(K,{}),e.jsx(Q,{}),e.jsx(V,{},"recent-activity-feed")]})]})}),e.jsxs("div",{className:"flex flex-col items-center lg:items-start justify-start lg:flex-row lg:gap-6 w-full lg:w-2/3",children:[e.jsxs("div",{className:"flex flex-col items-center w-4/5 lg:!w-1/2 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[e.jsx("h2",{className:"text-3xl font-bold !mt-6 !mb-10 lg:!mt-8 xl:!mt-6 text-center",children:"My Account"}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-[#5800FF] shadow-md shadow-[#5800FF] !p-6 !space-y-4 w-full max-w-md mx-auto",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 !pb-2",children:"Name:"}),e.jsx("p",{className:"text-lg font-semibold !pb-2 text-black",children:l.name})]}),e.jsxs("div",{className:"w-full !mb-6 text-black",children:[e.jsx("input",{type:"text",id:"name",className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black",value:j,onChange:r=>_(r.target.value)}),e.jsx("button",{className:"!mt-2 bg-[#5800FF] hover:bg-[#E900FF] text-white font-bold !py-2 !px-4 rounded w-full",onClick:Y,disabled:s,children:"Update Name"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Email:"}),e.jsx("input",{type:"email",value:x,onChange:r=>g(r.target.value),className:"!mt-1 !p-4 border rounded w-full text-black"}),e.jsx("button",{onClick:D,disabled:s,className:"!mt-2 bg-[#5800FF] hover:bg-[#E900FF] text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Updating...":"Update Email"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Current Password:"}),e.jsx("input",{type:"password",ref:u,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"New Password:"}),e.jsx("input",{type:"password",ref:i,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Confirm New Password:"}),e.jsx("input",{type:"password",ref:w,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("button",{onClick:U,disabled:s,className:"!mt-2 bg-[#5800FF] hover:bg-[#E900FF] text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Updating...":"Update Password"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Newsletter Subscription:"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:m?"You are currently subscribed to receive blog newsletters by email.":"Subscribe to receive blog newsletters and updates by email."}),e.jsx("button",{onClick:R,disabled:s,className:`!mt-2 ${m?"bg-red-500":"bg-green-500"} hover:opacity-80 text-white font-bold !py-2 !px-4 rounded w-full`,children:m?"Unsubscribe":"Subscribe to Newsletters"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Comment Notifications:"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:y?"You will receive an email when someone replies to your comments.":"Enable to get notified by email when someone replies to your comments."}),e.jsx("button",{onClick:A,disabled:s,className:`!mt-2 ${y?"bg-red-500":"bg-green-500"} hover:opacity-80 text-white font-bold !py-2 !px-4 rounded w-full`,children:y?"Disable Comment Notifications":"Enable Comment Notifications"})]}),e.jsxs("div",{className:"!mb-4 flex flex-col items-center !gap-3",children:[l.profile_photo_path&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"text-sm font-semibold !mb-3",children:"Current Profile Image"}),e.jsx("img",{src:`/storage/${l.profile_photo_path}`,alt:"Current Profile",className:"w-32 h-32 object-cover rounded-full border"}),e.jsx("button",{onClick:L,disabled:s,className:"!mt-2 bg-red-600 hover:bg-red-700 text-white font-bold !py-2 !px-4 rounded",children:s?"Deleting...":"Delete Profile Image"})]}),e.jsx("label",{htmlFor:"profile_photo",className:"text-sm text-slate-500 italic !mt-4",children:"Upload New Profile Photo"}),e.jsx("input",{id:"profile_photo",name:"profile_photo",type:"file",accept:"image/*",ref:N,onChange:I,disabled:s,className:`file-input block w-60 md:w-80 border-2 border-dashed rounded-lg !p-2 cursor-pointer bg-white hover:bg-slate-50 dark:bg-slate-900 dark:hover:bg-slate-800 transition
                  border-gray-400 text-sm text-slate-700 dark:text-slate-200 file:!mr-4 file:!py-2 file:!px-4
                  file:rounded-full file:border-0 file:text-sm file:font-semibold
                  file:bg-indigo-50 file:text-indigo-700
                  hover:file:bg-indigo-100`}),C&&e.jsxs("div",{className:"flex flex-col items-center !mt-4",children:[e.jsx("label",{className:"text-sm font-semibold !mb-1",children:"Preview"}),e.jsx("img",{src:C,alt:"Preview",className:"w-32 h-32 object-cover rounded-full border"})]}),e.jsx("button",{onClick:T,disabled:s,className:"!mt-2 bg-[#5800FF] text-white !px-4 !py-2 rounded hover:bg-[#4700cc] disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Uploading...":"Upload Image"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Delete Account:"}),e.jsx("p",{className:"text-xs text-gray-500 !mb-1",children:"Deleting your account will remove your profile and (optionally) your comments. This action cannot be undone."}),e.jsx("button",{onClick:$,disabled:s,className:"!mt-6 bg-red-500 hover:bg-red-600 text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Deleting...":"Delete Account"})]})]})]}),e.jsx("div",{className:"w-full lg:w-1/2 lg:!min-h-[140vh] flex flex-col lg:justify-start items-start",children:e.jsx(W,{userId:l.id})})]})]})})})]})}export{oe as default};
