import{j as e,q as ue,b as pe,c as he,d as fe,f as N,J as ge}from"./ConfirmationContext-BgD69WF4.js";import{r as d,H as we}from"./vendor-CfxRerCp.js";import{a as j}from"./axiosInstance-XGWuhqFT.js";import{g as U}from"./Navbar-3pRjB-Lg.js";import{S as ye}from"./Spinner4-BBfDOIyg.js";import{M as be}from"./index-DHe08Kkl.js";function je({postUrl:r,postTitle:v}){const w=encodeURIComponent(r),F=encodeURIComponent(v);return e.jsxs("div",{className:"gap-2 md:gap-2 !mt-4 flex flex-row justify-center items-center  md:justify-start md:items-start",children:[e.jsx("a",{href:`https://twitter.com/intent/tweet?url=${w}&text=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-black border-1 border-white text-white rounded hover:opacity-80",children:"Share on X"}),e.jsx("a",{href:`https://www.facebook.com/sharer/sharer.php?u=${w}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-blue-700 text-white rounded hover:opacity-80",children:"Share on Facebook"}),e.jsx("a",{href:`https://www.linkedin.com/shareArticle?url=${w}&title=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-[#0A66C2] text-white rounded hover:opacity-80",children:"Share on LinkedIn"}),e.jsx("a",{href:`https://www.reddit.com/submit?url=${w}&title=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-[#FF4500] text-white rounded hover:opacity-80",children:"Share on Reddit"})]})}function $e({post:r,isPostPage:v=!1}){const{auth:w,seo:F}=ue().props,h={...F},i=w.user,E=!!i;i==null||i.token;const q=i?!!i.is_admin:!1,[D,X]=d.useState(v),[H,_]=d.useState(null),[T,S]=d.useState(""),[Fe,Ce]=d.useState(""),[y,b]=d.useState(!1),{showAlert:m}=pe(),{confirm:I}=he(),[c,f]=d.useState([]),[G,k]=d.useState(null),R=d.useRef(null),[P,V]=d.useState(!0),[A,K]=d.useState(!1),Q=()=>{V(!1)},Z=()=>{V(!1),K(!0)},$=d.useRef(null),C=d.useRef(null);d.useEffect(()=>{async function t(){try{const a=(await j.get(`api/comments/${r.id}`)).data.map(n=>({...n,createdAt:new Date(n.createdAt).toISOString()}));f(a)}catch(s){console.error("Failed to fetch comments",s)}}t()},[r.id]);const ee=async t=>{await I({title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger"})&&N.delete(`/posts/${t}`,{onSuccess:()=>{m("Post deleted successfully","success"),N.visit("/")},onError:()=>{m("Failed to delete post","error")}})};async function te(t){if(t.preventDefault(),!C.current||!C.current.value.trim())return;if(!(r!=null&&r.id)){m("Post ID missing","error");return}const s=C.current.value,a={post_id:r.id,content:s,user_id:(i==null?void 0:i.id)||0};b(!0),await U();try{const n=await j.post("/api/comments",a),o={...n.data,user_id:(i==null?void 0:i.id)||0,user:{id:i==null?void 0:i.id,name:i==null?void 0:i.name}};f(x=>[...x,o]),S(n.data.message||"Comment posted successfully"),C.current.value="",setTimeout(()=>{S("")},5e3)}catch(n){console.error("Failed to post comment",n),S("Error posting comment. We apologize for the inconvenience. If you hit the limit of 10 messages per day, please try again tomorrow."),setTimeout(()=>{S("")},5e3)}finally{b(!1)}}const W=t=>{if(v){const s=t.currentTarget;document.fullscreenElement===s?document.exitFullscreen():s.requestFullscreen()}else J()};async function se(t,s){if(t.preventDefault(),!$.current||!$.current.value.trim())return;const a=$.current.value,n={post_id:r.id,content:a,parent_id:s};b(!0),await U();try{const o=await j.post("/api/comments",n);f([...c,o.data]),_(null)}catch(o){console.error("Failed to post reply",o),m("Error posting reply","error")}finally{b(!1)}}const re=(t,s)=>{const a=L(t,s),n=z(a,s);return n.length>0&&n.every(o=>o.deleted)},L=(t,s)=>{const a=s.find(n=>n._id===t);return!a||!a.parent_id?t:L(a.parent_id,s)},z=(t,s)=>{const a=[],n=s.find(x=>x._id===t);n&&a.push(n);const o=x=>{s.filter(g=>g.parent_id===x).forEach(g=>{a.push(g),o(g._id)})};return o(t),a},ne=async t=>{if(await I({title:"Delete Comment",message:"Are you sure you want to delete this comment?",confirmText:"Delete",cancelText:"Cancel",type:"danger"}))try{const a=await j.delete(`/api/comments/${t}`),n=c.map(o=>o._id===t?{...o,deleted:!0,content:"[Message removed by moderator]"}:o);if(re(t,n)){const o=L(t,n),x=z(o,n).map(u=>u._id);f(n.filter(u=>!x.includes(u._id)))}else f(n)}catch(a){console.error("Failed to delete comment",a),a.response&&a.response.status===401?(m("You need to be logged in to delete comments","error"),window.location.href="/login"):m("Error deleting comment. Please try again.","error")}};function J(){r.slug?N.visit(`/post/${r.slug}`):N.visit(`/post/${r.id}`)}const ae=!!(r.image_url&&r.image_url!=="null"&&r.image_url!=="undefined"),oe=t=>c.filter(s=>s.parent_id===t),ie=()=>c.filter(t=>!t.parent_id),O=(t,s=0)=>{const n=H===t._id,o=G===t._id,x=oe(t._id),u=t.deleted,g=!!(i&&t.user_id&&i.id===t.user_id),de=c.some(l=>l.parent_id===t._id),Y=window.innerWidth<768?Math.min(s,3):s,me=Y>0?`!ml-${Math.min(Y*4,12)}`:"";async function ce(l){if(!R.current||!R.current.value.trim())return;const B=R.current.value;b(!0),await U();try{const M=await j.put(`/api/comments/${l}`,{content:B});f(c.map(p=>p._id===l?{...p,content:B,edited:!0}:p)),k(null),m("Comment updated successfully","success")}catch(M){console.error("Failed to update comment",M),m("Error updating comment. Please try again.","error")}finally{b(!1)}}async function xe(l){if(c.some(p=>p.parent_id===l)){m("Cannot delete a comment with replies","warning");return}if(await I({title:"Delete Comment",message:"Are you sure you want to delete your comment?",confirmText:"Delete",cancelText:"Cancel",type:"warning"}))try{await j.delete(`/api/comments/${l}`),f(c.filter(p=>p._id!==l)),m("Your comment has been deleted","success")}catch(p){console.error("Failed to delete comment",p),m("Error deleting comment. Please try again.","error")}}return e.jsxs("div",{className:`bg-[#5800FF]/${10-Math.min(s,5)*2} rounded !p-2 md:!p-3 ${me}`,children:[e.jsx("p",{className:"font-medium text-xs md:text-sm",children:t.authorName}),u?e.jsx("p",{className:"opacity-60 italic text-xs md:text-sm",children:"[Message removed by moderator]"}):o?e.jsxs("form",{onSubmit:l=>{l.preventDefault(),ce(t._id)},className:"!mt-2",children:[e.jsx("textarea",{ref:R,className:"w-full !p-2 h-20 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-xs md:text-sm",rows:3,defaultValue:t.content}),e.jsxs("div",{className:"flex gap-2 !mt-1",children:[e.jsx("button",{type:"submit",disabled:y,className:"!px-2 !py-1 md:!px-3 md:!py-1 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-[10px] md:text-sm",children:y?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>k(null),className:"!px-2 !py-1 md:!px-3 md:!py-1 border border-[#5800FF]/20 rounded hover:bg-[#5800FF]/10 text-[10px] md:text-sm",children:"Cancel"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80 break-words max-w-full overflow-wrap md:!max-w-240 overflow-wrap-anywhere h-auto text-xs md:text-sm",children:t.content}),t.edited&&e.jsx("p",{className:"text-[10px] opacity-60 italic",children:"(edited)"})]}),!o&&e.jsx("p",{className:"text-[10px] md:text-xs opacity-60 italic",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("div",{className:"flex gap-2 !mt-1 md:!mt-2",children:[!u&&s<10&&E&&e.jsx("button",{onClick:()=>{_(t._id),k(null)},className:"text-[10px] md:text-xs text-[#E900FF] hover:underline",children:"Reply"}),!u&&g&&!o&&e.jsx("button",{onClick:()=>{k(t._id),_(null)},className:"text-[10px] text-[#FFC600] md:text-xs hover:underline",children:"Edit"}),!u&&g&&!de&&e.jsx("button",{onClick:()=>xe(t._id),className:"text-red-500 text-[10px] md:text-xs hover:underline",children:"Delete"}),!u&&q&&e.jsx("button",{onClick:()=>ne(t._id),className:"text-red-500 text-[10px] md:text-xs hover:underline",children:"Delete (Admin)"})]}),n&&e.jsxs("form",{onSubmit:l=>se(l,t._id),className:"!mt-2 md:!mt-3",children:[e.jsx("textarea",{ref:$,placeholder:`Reply to ${t.authorName}...`,className:"w-full !p-2 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-xs md:text-sm",rows:2,defaultValue:""}),e.jsxs("div",{className:"flex gap-2 !mt-1",children:[e.jsx("button",{type:"submit",disabled:y,className:"!px-2 !py-1 md:!px-3 md:!py-1 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-[10px] md:text-sm",children:y?"Posting...":"Post Reply"}),e.jsx("button",{type:"button",onClick:()=>_(null),className:"!px-2 !py-1 md:!px-3 md:!py-1 border border-[#5800FF]/20 rounded hover:bg-[#5800FF]/10 text-[10px] md:text-sm",children:"Cancel"})]})]}),x.length>0&&e.jsx("div",{className:"!mt-2 md:!mt-3 !space-y-2 md:!space-y-3",children:x.map(l=>O(l,s+1))})]},t._id)},le=`/posts/${r.id}`;return e.jsxs(e.Fragment,{children:[e.jsx(fe,{children:e.jsx("link",{rel:"alternate",type:"application/rss+xml",title:"RSS Feed for Joni's Blog",href:"/feed"})}),e.jsxs(we,{children:[e.jsx("title",{children:h.title}),e.jsx("meta",{name:"description",content:h.description}),e.jsx("meta",{name:"keywords",content:h.keywords||"blog, post"}),e.jsx("meta",{property:"og:title",content:h.title}),e.jsx("meta",{property:"og:description",content:h.description}),e.jsx("meta",{property:"og:image",content:h.image||"/default-image.jpg"}),e.jsx("meta",{property:"og:url",content:h.url})]}),e.jsxs("article",{className:"article-container flex flex-col justify-center items-center lg:items-start lg:justify-start rounded-lg bg-[#5800FF]/5 !p-4 md:!pl-10 w-full md:!w-150 xl:!w-220 2xl:!w-260 !mb-6 md:!mb-10 lg:!ml-10 2xl:!ml-32",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold flex justify-start !mb-4 md:!mb-10 cursor-pointer hover:underline !max-w-[800px]",onClick:J,children:r.title}),ae&&r.image_url&&e.jsxs("div",{className:"relative w-full flex flex-row justify-center items-center md:justify-start lg:items-start !mb-6 md:!mb-20 !mt-4",style:{width:"100%",maxWidth:"40rem",minHeight:"16rem"},children:[P&&!A&&e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10",children:e.jsx(ye,{size:64})}),!A&&e.jsx("img",{src:r.image_url,className:`w-full !max-w-[360px] sm:w-65 md:!max-w-none md:w-100 lg:w-150 h-auto cursor-pointer transition-opacity duration-300 ${P?"opacity-0":"opacity-100"}`,onClick:W,onLoad:Q,onError:Z}),A&&e.jsx("div",{className:"w-full flex flex-col items-center lg:items-start",children:e.jsx("img",{src:"/fallbackimage.jpg",alt:`Placeholder for ${r.title}`,className:`w-full md:w-[25rem] lg:w-[37.5rem] h-auto cursor-pointer transition-opacity duration-300 ${P?"opacity-0":"opacity-100"}`,onClick:W})})]}),e.jsx(be,{children:r.content||"(No content)",components:{p:({node:t,...s})=>e.jsx("p",{className:"!text-sm md:!text-base xl:!text-lg !mb-4 !mt-2 min-w-[340px] max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),ul:({node:t,...s})=>e.jsx("ul",{className:"list-disc !ml-6 !mb-4",...s}),ol:({node:t,...s})=>e.jsx("ol",{className:"list-decimal !ml-6 !mb-4",...s}),li:({node:t,...s})=>e.jsx("li",{className:"!mb-2 !ml-6 max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),a:({node:t,...s})=>e.jsx("a",{className:"text-purple-400 hover:text-white transition-colors",...s}),strong:({node:t,...s})=>e.jsx("strong",{className:"!mt-4 font-bold max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),em:({node:t,...s})=>e.jsx("em",{className:"italic",...s}),blockquote:({node:t,...s})=>e.jsx("blockquote",{className:"!border-l-4 border-gray-300 !pl-4 italic text-gray-600 !mb-4 max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),code:({node:t,inline:s,className:a,children:n,...o})=>s?e.jsx("code",{className:"text-sm !px-1 !py-0.5 rounded break-words whitespace-pre-wrap",...o,children:n}):e.jsx("pre",{className:"break-words whitespace-pre-wrap !p-4 rounded text-sm max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",children:e.jsx("code",{className:a,...o,children:n})})}}),e.jsxs("div",{className:"text-xs md:text-sm flex flex-col justify-center items-center  md:justify-start md:items-start text-gray-500 !mt-3 !pt-4 md:!pt-6 !space-y-1 border-t border-[#5800FF]/20",children:[r.created_at&&e.jsxs("div",{children:["Created: ",new Date(r.created_at).toLocaleString()]}),r.updated_at&&r.updated_at!==r.created_at&&e.jsxs("div",{className:"italic",children:["Updated: ",new Date(r.updated_at).toLocaleString()]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"!mt-4 flex flex-wrap gap-2",children:r.tags.map(t=>e.jsxs("span",{className:"bg-[#5800FF]/20 text-[#5800FF] text-xs md:text-sm !px-2 !py-1 rounded cursor-pointer hover:bg-[#5800FF]/40",onClick:()=>{N.get(`/posts/tag/${encodeURIComponent(t.name)}`)},children:["#",t.name]},t.id))}),e.jsx(je,{postUrl:le,postTitle:r.title}),q&&e.jsx("button",{onClick:()=>ee(r.id),className:"right-4 md:top-10 md:right-30 !px-3 !py-1 bg-red-600 text-white rounded hover:bg-red-800 transition-colors !mt-4",children:"Delete"})]}),e.jsxs("div",{className:"!mt-4 md:!mt-6 !pt-4 md:!pt-6 border-t border-[#5800FF]/20 w-full",children:[e.jsx("button",{onClick:()=>X(!D),className:"text-xs md:text-sm opacity-70 hover:opacity-100 transition-opacity",children:D?"Hide Comments":`Show Comments (${c.length})`}),D&&e.jsxs("div",{className:"!mt-3 md:!mt-4 !space-y-3 md:!space-y-4 w-full",children:[c.length>0?ie().map(t=>O(t)):e.jsx("p",{className:"text-xs md:text-sm opacity-60 italic",children:"No comments yet. Be the first!"}),E&&H===null&&e.jsxs("form",{onSubmit:te,className:"!mt-4 md:!mt-6",children:[e.jsx("textarea",{ref:C,placeholder:"Write a comment...",className:"w-full !p-2 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-sm md:text-base",rows:3,defaultValue:""}),e.jsx("button",{type:"submit",disabled:y,className:"!mt-2 !px-3 !py-1 md:!px-4 md:!py-2 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-sm md:text-base",children:y?"Posting...":"Post Comment"})]}),T&&e.jsx("div",{className:`message ${T.includes("Error")?"error":"success"} !p-2 rounded-md !mt-2 w-auto`,style:{transition:"opacity 0.5s ease-in-out"},children:T}),!E&&e.jsxs("p",{className:"text-xs md:text-sm !mt-2 md:!mt-4",children:[e.jsx(ge,{href:"/login",className:"text-[#5800FF] hover:underline",children:"Sign in"})," ","to leave a comment."]})]})]})]})]})}export{$e as B};
