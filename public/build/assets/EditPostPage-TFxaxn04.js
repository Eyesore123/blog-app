import{u as P,r as l,S as U,j as e,f as I}from"./ConfirmationContext-B_AdGWYB.js";import{T as R,t as m}from"./index-Dh5Cl-3c.js";import{H as D}from"./Header-Cfc4JRbS.js";import{N as _,g as $}from"./Navbar-DgVBYgo-.js";import{a as L}from"./axiosInstance-CnLbWm-t.js";const q=({post:r})=>{const{theme:y}=P(),[u,w]=l.useState(r.title),[p,F]=l.useState(r.content),[x,T]=l.useState(r.topic),[i,d]=l.useState([]),[g,b]=l.useState(""),[f,h]=l.useState(!1),[o,S]=l.useState(null),[j,v]=l.useState(null),{setData:c}=U({title:"",content:"",topic:"",image:null,tags:[]});l.useEffect(()=>{var a;const t=((a=r.tags)==null?void 0:a.map(n=>n.name))||[];d(t),c("tags",t)},[r.tags,c]),l.useEffect(()=>{if(o){const t=URL.createObjectURL(o);return v(t),()=>URL.revokeObjectURL(t)}v(null)},[o]);const N=()=>{const t=g.trim();if(t&&!i.includes(t)){const a=[...i,t];d(a),c("tags",a)}b("")},E=t=>{const a=i.filter(n=>n!==t);d(a),c("tags",a)},C=async t=>{var a,n;t.preventDefault(),h(!0),await $();try{const s=new FormData;s.append("title",u),s.append("content",p),s.append("topic",x),s.append("_method","PUT"),i.forEach(k=>s.append("tags[]",k)),o&&s.append("image",o),await L.post(`/api/posts/${r.id}`,s),m.success("Post updated successfully"),I.visit(`/post/${r.id}`)}catch(s){(n=(a=s.response)==null?void 0:a.data)!=null&&n.errors?(console.error("Validation Errors:",s.response.data.errors),m.error("Validation error — check your fields")):(console.error("Error updating post",s),m.error("Error updating post"))}finally{h(!1)}};return e.jsx("div",{className:`min-h-160 ${y}`,children:e.jsxs("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[e.jsx(_,{}),e.jsx(D,{}),e.jsx("div",{className:"w-full mx-auto flex justify-center items-center gap-4 md:gap-10 xl:gap-18 !mt-20",children:e.jsxs("main",{className:"!p-8 mx-auto flex flex-col min-w-200 justify-center gap-8",children:[e.jsx("h1",{className:"text-3xl font-bold !mb-6",children:"Edit Post"}),e.jsxs("form",{onSubmit:C,encType:"multipart/form-data",className:"!space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Title"}),e.jsx("input",{type:"text",value:u,onChange:t=>w(t.target.value),className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Content"}),e.jsx("textarea",{value:p,onChange:t=>F(t.target.value),className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]",rows:8})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Image Upload"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{var n;const a=((n=t.target.files)==null?void 0:n[0])||null;S(a),c("image",a)},className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"}),j?e.jsxs("div",{className:"!mt-2",children:[e.jsx("p",{className:"text-sm !mb-3",children:"New Image Preview:"}),e.jsx("img",{src:j,alt:"Preview",className:"max-w-xs rounded shadow"})]}):r.image_url?e.jsxs("div",{className:"!mt-2",children:[e.jsx("p",{className:"text-sm !mb-3",children:"Current Image:"}),e.jsx("a",{href:`/storage/${r.image_url.replace(/^uploads\//,"")}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:r.image_url,alt:"Current",className:"max-w-xs rounded shadow"})})]}):e.jsx("p",{className:"text-sm mt-1 text-gray-500",children:"No image uploaded."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-4 !mb-2",children:[e.jsx("input",{type:"text",value:g,onChange:t=>b(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),N())},placeholder:"Add tag and press Enter",className:"flex-grow !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"}),e.jsx("button",{type:"button",onClick:N,className:"bg-[#5800FF] text-white !px-3 !py-1 rounded hover:bg-[#E900FF] transition",children:"Add"})]}),e.jsx("div",{className:"!mt-2 flex flex-wrap gap-4",children:i.map(t=>e.jsxs("div",{className:"flex items-center bg-[#5800FF] text-white rounded !px-3 !py-1 text-sm cursor-default select-none",children:[t,e.jsx("button",{type:"button",onClick:()=>E(t),className:"!ml-2 text-white hover:text-gray-300 font-bold","aria-label":`Remove tag ${t}`,children:"×"})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Topic"}),e.jsx("input",{type:"text",value:x,onChange:t=>T(t.target.value),className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"})]}),e.jsx("button",{type:"submit",disabled:f,className:"!px-4 !py-2 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors",children:f?"Saving...":"Save Changes"})]}),e.jsx(R,{})]})})]})})};export{q as default};
