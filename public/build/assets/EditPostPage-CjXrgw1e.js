import{u as W,S as $,j as e,a as S,f as A}from"./axiosInstance-B60J37ny.js";import{r}from"./vendor-CfxRerCp.js";import{T as O,t as p}from"./index-BgMHZnzL.js";import{H}from"./Header-DLvWApgL.js";import{N as V,g as K}from"./app-BZ86fJkl.js";const M=({post:s})=>{const{theme:E}=W(),[x,k]=r.useState(s.title),[h,C]=r.useState(s.content),[b,_]=r.useState(s.topic),[o,d]=r.useState([]),[I,U]=r.useState(!0),[g,P]=r.useState([]),[f,j]=r.useState(""),[v,N]=r.useState(!1),[c,y]=r.useState(null),[l,w]=r.useState(s.image_url||""),[F,u]=r.useState(null),{setData:m}=$({title:"",content:"",topic:"",published:!0,image:null,tags:[]});r.useEffect(()=>{var a;const t=((a=s.tags)==null?void 0:a.map(i=>i.name))||[];d(t),m("tags",t)},[s.tags,m]),r.useEffect(()=>{if(c){const t=URL.createObjectURL(c);return u(t),()=>URL.revokeObjectURL(t)}else if(l&&(l.startsWith("http://")||l.startsWith("https://")))u(l);else if(s.image_url){const t=s.image_url.startsWith("http://")||s.image_url.startsWith("https://");u(t?s.image_url:`/storage/${s.image_url}`)}else u("")},[c,l,s.image_url]),console.log(s.image_url,F),r.useEffect(()=>{(async()=>{const i=await(await S.get("/api/tags")).data;P(i),U(!1)})()},[]);const T=()=>{const t=f.trim();if(t&&!o.includes(t)){const a=[...o,t];d(a),m("tags",a)}j("")},L=t=>{const a=o.filter(i=>i!==t);d(a),m("tags",a)},R=async t=>{var a,i;t.preventDefault(),N(!0),await K();try{const n=new FormData;n.append("title",x),n.append("content",h),n.append("topic",b),n.append("_method","PUT"),o.forEach(D=>n.append("tags[]",D)),c?n.append("image",c):l&&(l.startsWith("http://")||l.startsWith("https://"))&&n.append("image_url",l),await S.post(`/api/posts/${s.id}`,n),p.success("Post updated successfully"),setTimeout(()=>{A.visit(`/post/${s.id}`,{data:{flash:{success:"Post updated successfully!"}},preserveState:!0})},2e3)}catch(n){(i=(a=n.response)==null?void 0:a.data)!=null&&i.errors?(console.error("Validation Errors:",n.response.data.errors),p.error("Validation error â€” check your fields")):(console.error("Error updating post",n),p.error("Error updating post"))}finally{N(!1)}};return e.jsx("div",{className:`min-h-160 ${E}`,children:e.jsxs("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[e.jsx(V,{}),e.jsx(H,{}),e.jsx("div",{className:"w-full mx-auto flex justify-center items-center gap-4 md:gap-10 xl:gap-18 !mt-20",children:e.jsxs("main",{className:"!p-8 mx-auto flex flex-col min-w-200 justify-center gap-8 xl:!max-w-2/3",children:[e.jsx("h1",{className:"text-3xl font-bold !mb-6",children:"Edit Post"}),e.jsxs("form",{onSubmit:R,encType:"multipart/form-data",className:"!space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Title"}),e.jsx("input",{type:"text",value:x,onChange:t=>k(t.target.value),className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Content"}),e.jsx("textarea",{value:h,onChange:t=>C(t.target.value),className:"edittextarea w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]",rows:1})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Image Upload"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{var i;const a=((i=t.target.files)==null?void 0:i[0])||null;y(a),a&&w(""),m("image",a)},className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"}),e.jsx("label",{className:"block !mt-4 !mb-2 font-medium",children:"Or Image URL"}),e.jsx("input",{type:"text",placeholder:"https://example.com/myimage.jpg",value:l,onChange:t=>{w(t.target.value),y(null)},className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"}),c?e.jsxs("div",{className:"!mt-2",children:[e.jsx("p",{className:"text-sm !mb-3",children:"New Image Preview:"}),e.jsx("img",{src:F||"",alt:"Preview",className:"max-w-xs rounded shadow",onError:t=>t.currentTarget.src="https://placehold.co/400x300?text=Image+not+found"})]}):l?e.jsxs("div",{className:"!mt-2",children:[e.jsx("p",{className:"text-sm !mb-3",children:"New Image Preview (URL):"}),e.jsx("img",{src:l,alt:"Preview",className:"max-w-xs rounded shadow",onError:t=>t.currentTarget.src="https://placehold.co/400x300?text=Image+not+found"})]}):s.image_url?e.jsxs("div",{className:"!mt-2",children:[e.jsx("p",{className:"text-sm !mb-3",children:"Current Image:"}),e.jsx("a",{href:`https://blog.joniputkinen.com/storage${s.image_url}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:`https://blog.joniputkinen.com/storage${s.image_url}`,alt:"Current",className:"max-w-xs rounded shadow"})})]}):e.jsx("p",{className:"text-sm mt-1 text-gray-500",children:"No image uploaded."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-4 !mb-2",children:[e.jsx("input",{type:"text",value:f,onChange:t=>j(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),T())},placeholder:"Add tag and press Enter",className:"flex-grow !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"}),e.jsx("button",{type:"button",onClick:T,className:"bg-[#5800FF] text-white !px-3 !py-1 rounded hover:bg-[#E900FF] transition",children:"Add"})]}),I?e.jsx("p",{className:"!mb-2",children:"Loading tags..."}):g&&g.length>0&&e.jsx("div",{className:"!mb-2 !mt-2 !flex !flex-wrap !gap-2",children:g.filter(t=>!o.includes(t)).map(t=>e.jsx("button",{type:"button",className:"!bg-gray-200 !text-[#5800FF] !rounded !px-3 !py-1 !text-sm hover:!bg-[#5800FF] hover:!text-white transition",onClick:()=>{const a=[...o,t];d(a),m("tags",a)},children:t},t))}),e.jsx("div",{className:"!mt-4 flex flex-wrap gap-4",children:o.map(t=>e.jsxs("div",{className:"flex items-center bg-[#5800FF] text-white rounded !px-3 !py-1 text-sm cursor-default select-none",children:[t,e.jsx("button",{type:"button",onClick:()=>L(t),className:"!ml-2 !text-sm !text-white",children:"x"})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block !mb-3 font-medium",children:"Topic"}),e.jsx("input",{type:"text",value:b,onChange:t=>_(t.target.value),className:"w-full !p-2 rounded border border-[#5800FF] bg-[var(--bg-primary)]"})]}),e.jsx("button",{type:"submit",disabled:v,className:"!px-4 !py-2 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors",children:v?"Saving...":"Save Changes"})]}),e.jsx(O,{})]})})]})})};export{M as default};
