import{j as e,q as he,b as ge,c as fe,u as we,d as ye,f as C,J as be,a as j}from"./axiosInstance-B60J37ny.js";import{r as d,H as je}from"./vendor-CfxRerCp.js";import{g as U}from"./app-BZ86fJkl.js";import{S as Fe}from"./Spinner4-BhOwiG6x.js";import{M as Ne}from"./index-BwfBZVYM.js";function Ce({postUrl:n,postTitle:v}){const w=encodeURIComponent(n),F=encodeURIComponent(v);return e.jsxs("div",{className:"gap-2 md:gap-2 !mt-4 flex flex-row justify-center items-center  md:justify-start md:items-start",children:[e.jsx("a",{href:`https://twitter.com/intent/tweet?url=${w}&text=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-black border-1 border-white text-white rounded hover:opacity-80",children:"Share on X"}),e.jsx("a",{href:`https://www.facebook.com/sharer/sharer.php?u=${w}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-blue-700 text-white rounded hover:opacity-80",children:"Share on Facebook"}),e.jsx("a",{href:`https://www.linkedin.com/shareArticle?url=${w}&title=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-[#0A66C2] text-white rounded hover:opacity-80",children:"Share on LinkedIn"}),e.jsx("a",{href:`https://www.reddit.com/submit?url=${w}&title=${F}`,target:"_blank",rel:"noopener noreferrer",className:"!px-2 !py-1 bg-[#FF4500] text-white rounded hover:opacity-80",children:"Share on Reddit"})]})}function Pe({post:n,isPostPage:v=!1}){var Y;const w={"@context":"https://schema.org","@type":"BlogPosting",mainEntityOfPage:{"@type":"WebPage","@id":`https://blog.joniputkinen.com/posts/${n.slug||n.id}`},headline:n.title,description:(Y=n.content)==null?void 0:Y.slice(0,160),image:n.image_url||"https://blog.joniputkinen.com/fallbackimage.jpg",author:{"@type":"Person",name:"Joni Putkinen"},publisher:{"@type":"Person",name:"Joni Putkinen"},datePublished:n.created_at,dateModified:n.updated_at},{auth:F,seo:G}=he().props,h={...G},i=F.user,R=!!i;i==null||i.token;const J=i?!!i.is_admin:!1,[D,K]=d.useState(v),[W,_]=d.useState(null),[P,k]=d.useState(""),[ve,_e]=d.useState(""),[y,b]=d.useState(!1),{showAlert:m}=ge(),{confirm:T}=fe(),[c,g]=d.useState([]),[Q,S]=d.useState(null),$=d.useRef(null),[I,q]=d.useState(!0),[A,Z]=d.useState(!1),{theme:ke}=we(),ee=()=>{q(!1)},te=()=>{q(!1),Z(!0)},E=d.useRef(null),N=d.useRef(null);d.useEffect(()=>{async function t(){try{const a=(await j.get(`api/comments/${n.id}`)).data.map(r=>({...r,createdAt:new Date(r.createdAt).toISOString()}));g(a)}catch(s){console.error("Failed to fetch comments",s)}}t()},[n.id]);const se=async t=>{await T({title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger"})&&C.delete(`/posts/${t}`,{onSuccess:()=>{m("Post deleted successfully","success"),C.visit("/")},onError:()=>{m("Failed to delete post","error")}})};async function ne(t){if(t.preventDefault(),!N.current||!N.current.value.trim())return;if(!(n!=null&&n.id)){m("Post ID missing","error");return}const s=N.current.value,a={post_id:n.id,content:s,user_id:(i==null?void 0:i.id)||0};b(!0),await U();try{const r=await j.post("/api/comments",a),o={...r.data,user_id:(i==null?void 0:i.id)||0,user:{id:i==null?void 0:i.id,name:i==null?void 0:i.name}};g(x=>[...x,o]),k(r.data.message||"Comment posted successfully"),N.current.value="",setTimeout(()=>{k("")},5e3)}catch(r){console.error("Failed to post comment",r),k("Error posting comment. We apologize for the inconvenience. If you hit the limit of 10 messages per day, please try again tomorrow."),setTimeout(()=>{k("")},5e3)}finally{b(!1)}}const H=t=>{if(v){const s=t.currentTarget;document.fullscreenElement===s?document.exitFullscreen():s.requestFullscreen()}else V()};async function re(t,s){if(t.preventDefault(),!E.current||!E.current.value.trim())return;const a=E.current.value,r={post_id:n.id,content:a,parent_id:s};b(!0),await U();try{const o=await j.post("/api/comments",r);g([...c,o.data]),_(null)}catch(o){console.error("Failed to post reply",o),m("Error posting reply","error")}finally{b(!1)}}const ae=(t,s)=>{const a=B(t,s),r=O(a,s);return r.length>0&&r.every(o=>o.deleted)},B=(t,s)=>{const a=s.find(r=>r._id===t);return!a||!a.parent_id?t:B(a.parent_id,s)},O=(t,s)=>{const a=[],r=s.find(x=>x._id===t);r&&a.push(r);const o=x=>{s.filter(f=>f.parent_id===x).forEach(f=>{a.push(f),o(f._id)})};return o(t),a},oe=async t=>{if(await T({title:"Delete Comment",message:"Are you sure you want to delete this comment?",confirmText:"Delete",cancelText:"Cancel",type:"danger"}))try{const a=await j.delete(`/api/comments/${t}`),r=c.map(o=>o._id===t?{...o,deleted:!0,content:"[Message removed by moderator]"}:o);if(ae(t,r)){const o=B(t,r),x=O(o,r).map(u=>u._id);g(r.filter(u=>!x.includes(u._id)))}else g(r)}catch(a){console.error("Failed to delete comment",a),a.response&&a.response.status===401?(m("You need to be logged in to delete comments","error"),window.location.href="/login"):m("Error deleting comment. Please try again.","error")}};function V(){n.slug?C.visit(`/post/${n.slug}`):C.visit(`/post/${n.id}`),window.scrollTo({top:0,behavior:"smooth"})}const ie=!!(n.image_url&&n.image_url!=="null"&&n.image_url!=="undefined"),le=t=>c.filter(s=>s.parent_id===t),de=()=>c.filter(t=>!t.parent_id),z=(t,s=0)=>{const r=W===t._id,o=Q===t._id,x=le(t._id),u=t.deleted,f=!!(i&&t.user_id&&i.id===t.user_id),ce=c.some(l=>l.parent_id===t._id),X=window.innerWidth<768?Math.min(s,3):s,xe=X>0?`!ml-${Math.min(X*4,12)}`:"";async function ue(l){if(!$.current||!$.current.value.trim())return;const L=$.current.value;b(!0),await U();try{const M=await j.put(`/api/comments/${l}`,{content:L});g(c.map(p=>p._id===l?{...p,content:L,edited:!0}:p)),S(null),m("Comment updated successfully","success")}catch(M){console.error("Failed to update comment",M),m("Error updating comment. Please try again.","error")}finally{b(!1)}}async function pe(l){if(c.some(p=>p.parent_id===l)){m("Cannot delete a comment with replies","warning");return}if(await T({title:"Delete Comment",message:"Are you sure you want to delete your comment?",confirmText:"Delete",cancelText:"Cancel",type:"warning"}))try{await j.delete(`/api/comments/${l}`),g(c.filter(p=>p._id!==l)),m("Your comment has been deleted","success")}catch(p){console.error("Failed to delete comment",p),m("Error deleting comment. Please try again.","error")}}return e.jsxs("div",{className:`bg-[#5800FF]/${10-Math.min(s,5)*2} rounded !p-2 md:!p-3 ${xe}`,children:[e.jsx("p",{className:"font-medium text-xs md:text-sm",children:t.authorName}),u?e.jsx("p",{className:"opacity-60 italic text-xs md:text-sm",children:"[Message removed by moderator]"}):o?e.jsxs("form",{onSubmit:l=>{l.preventDefault(),ue(t._id)},className:"!mt-2",children:[e.jsx("textarea",{ref:$,className:"w-full !p-2 h-20 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-xs md:text-sm",rows:3,defaultValue:t.content}),e.jsxs("div",{className:"flex gap-2 !mt-1",children:[e.jsx("button",{type:"submit",disabled:y,className:"!px-2 !py-1 md:!px-3 md:!py-1 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-[10px] md:text-sm",children:y?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>S(null),className:"!px-2 !py-1 md:!px-3 md:!py-1 border border-[#5800FF]/20 rounded hover:bg-[#5800FF]/10 text-[10px] md:text-sm",children:"Cancel"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80 break-words max-w-full overflow-wrap md:!max-w-240 overflow-wrap-anywhere h-auto text-xs md:text-sm",children:t.content}),t.edited&&e.jsx("p",{className:"text-[10px] opacity-60 italic",children:"(edited)"})]}),!o&&e.jsx("p",{className:"text-[10px] md:text-xs opacity-60 italic",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("div",{className:"flex gap-2 !mt-1 md:!mt-2",children:[!u&&s<10&&R&&e.jsx("button",{onClick:()=>{_(t._id),S(null)},className:"text-[10px] md:text-xs text-[#E900FF] hover:underline",children:"Reply"}),!u&&f&&!o&&e.jsx("button",{onClick:()=>{S(t._id),_(null)},className:"text-[10px] text-[#FFC600] md:text-xs hover:underline",children:"Edit"}),!u&&f&&!ce&&e.jsx("button",{onClick:()=>pe(t._id),className:"text-red-500 text-[10px] md:text-xs hover:underline",children:"Delete"}),!u&&J&&e.jsx("button",{onClick:()=>oe(t._id),className:"text-red-500 text-[10px] md:text-xs hover:underline",children:"Delete (Admin)"})]}),r&&e.jsxs("form",{onSubmit:l=>re(l,t._id),className:"!mt-2 md:!mt-3",children:[e.jsx("textarea",{ref:E,placeholder:`Reply to ${t.authorName}...`,className:"w-full !p-2 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-xs md:text-sm",rows:2,defaultValue:""}),e.jsxs("div",{className:"flex gap-2 !mt-1",children:[e.jsx("button",{type:"submit",disabled:y,className:"!px-2 !py-1 md:!px-3 md:!py-1 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-[10px] md:text-sm",children:y?"Posting...":"Post Reply"}),e.jsx("button",{type:"button",onClick:()=>_(null),className:"!px-2 !py-1 md:!px-3 md:!py-1 border border-[#5800FF]/20 rounded hover:bg-[#5800FF]/10 text-[10px] md:text-sm",children:"Cancel"})]})]}),x.length>0&&e.jsx("div",{className:"!mt-2 md:!mt-3 !space-y-2 md:!space-y-3",children:x.map(l=>z(l,s+1))})]},t._id)},me=`/posts/${n.id}`;return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsx("link",{rel:"alternate",type:"application/rss+xml",title:"RSS Feed for Joni's Blog",href:"/feed"})}),e.jsxs(je,{children:[e.jsx("title",{children:h.title}),e.jsx("link",{rel:"canonical",href:`https://blog.joniputkinen.com/post/${n.slug||n.id}`}),e.jsx("meta",{name:"description",content:h.description}),e.jsx("meta",{name:"keywords",content:h.keywords||"blog, post"}),e.jsx("meta",{property:"og:title",content:h.title}),e.jsx("meta",{property:"og:description",content:h.description}),e.jsx("meta",{property:"og:image",content:h.image||"/default-image.jpg"}),e.jsx("meta",{property:"og:url",content:h.url}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(w)})]}),e.jsx("div",{className:"bg-[var(--bg-primary)] rounded-lg",children:e.jsxs("article",{className:"article-container flex flex-col justify-center items-center lg:items-start lg:justify-start rounded-lg bg-[#5800FF]/10 !p-4 md:!pl-0 w-full md:!w-150 xl:!w-220 2xl:!w-260 !pb-6 md:!pb-10 lg:!pl-10 2xl:!pl-14",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold flex justify-start !mb-4 md:!mt-4 md:!mb-10 cursor-pointer hover:underline max-w-[360px] md:max-w-[500px] xl:max-w-[600px] 2xl:max-w-[800px]",onClick:V,children:n.title}),ie&&n.image_url&&e.jsxs("div",{className:"relative w-full flex flex-row justify-center items-center lg:justify-start lg:items-start !mb-6 md:!mb-20 !mt-4",style:{width:"100%",maxWidth:"40rem",minHeight:"16rem"},children:[I&&!A&&e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10",children:e.jsx(Fe,{size:64})}),!A&&e.jsx("img",{src:n.image_url,className:`w-full !max-w-[360px] sm:w-65 md:w-120 lg:max-w-120 xl:!max-w-none lg:w-150 h-auto cursor-pointer transition-opacity duration-300 ${I?"opacity-0":"opacity-100"}`,onClick:H,onLoad:ee,onError:te}),A&&e.jsx("div",{className:"w-full flex flex-col items-center lg:items-start",children:e.jsx("img",{src:"/fallbackimage.jpg",alt:`Placeholder for ${n.title}`,className:`w-full md:w-[25rem] lg:w-[37.5rem] h-auto cursor-pointer transition-opacity duration-300 ${I?"opacity-0":"opacity-100"}`,onClick:H})})]}),e.jsx(Ne,{children:n.content||"(No content)",components:{p:({node:t,...s})=>e.jsx("p",{className:"!text-sm md:!text-base 2xl:!text-lg !mb-4 !mt-2 md:!min-w-[340px] max-w-[340px] md:max-w-[500px] xl:max-w-[600px] xl:!pr-8 2xl:!pr-0 2xl:max-w-[900px] break-words",...s}),ul:({node:t,...s})=>e.jsx("ul",{className:"list-disc !ml-4 !mb-4",...s}),ol:({node:t,...s})=>e.jsx("ol",{className:"list-decimal !ml-4 !mb-4",...s}),li:({node:t,...s})=>e.jsx("li",{className:"!mb-2 !ml-4 max-w-[280px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),a:({node:t,...s})=>e.jsx("a",{className:"text-purple-400 hover:text-white transition-colors",...s}),strong:({node:t,...s})=>e.jsx("strong",{className:"!mt-4 font-bold max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),em:({node:t,...s})=>e.jsx("em",{className:"italic",...s}),blockquote:({node:t,...s})=>e.jsx("blockquote",{className:"!border-l-4 border-gray-300 !pl-4 italic text-gray-600 !mb-4 max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",...s}),code:({node:t,inline:s,className:a,children:r,...o})=>s?e.jsx("code",{className:"text-sm !px-1 !py-0.5 rounded break-words whitespace-pre-wrap",...o,children:r}):e.jsx("pre",{className:"break-words whitespace-pre-wrap !p-4 rounded text-sm max-w-[340px] md:max-w-[500px] xl:max-w-[700px] 2xl:max-w-[900px]",children:e.jsx("code",{className:a,...o,children:r})}),img:({node:t,...s})=>e.jsxs("figure",{className:"!mt-2 !mb-2 md:!mb-8 md:!mt-8 text-center",children:[e.jsx("img",{...s,className:"max-w-full h-auto rounded-lg mx-auto",alt:s.alt||"Image",onError:a=>{a.currentTarget.src="/placeholder_image.svg"}}),s.alt&&e.jsx("figcaption",{className:"text-sm text-gray-500 !mt-2 italic",children:s.alt})]})}}),e.jsxs("div",{className:"text-xs md:text-sm flex flex-col justify-center items-center  md:justify-start md:items-start text-gray-500 !mt-3 !pt-4 md:!pt-6 !space-y-1 border-t border-[#5800FF]/20",children:[n.created_at&&e.jsxs("div",{children:["Created: ",new Date(n.created_at).toLocaleString()]}),n.updated_at&&n.updated_at!==n.created_at&&e.jsxs("div",{className:"italic",children:["Updated: ",new Date(n.updated_at).toLocaleString()]}),n.tags&&n.tags.length>0&&e.jsx("div",{className:"!mt-4 flex flex-wrap gap-2",children:n.tags.map(t=>e.jsxs("span",{className:"bg-[#5800FF]/20 text-[#5800FF] text-xs md:text-sm !px-2 !py-1 rounded cursor-pointer hover:bg-[#5800FF]/40",onClick:()=>{C.get(`/posts/tag/${encodeURIComponent(t.name)}`)},children:["#",t.name]},t.id))}),e.jsx(Ce,{postUrl:me,postTitle:n.title}),J&&e.jsx("button",{onClick:()=>se(n.id),className:"right-4 md:top-10 md:right-30 !px-3 !py-1 bg-red-600 text-white rounded hover:bg-red-800 transition-colors !mt-4",children:"Delete"})]}),e.jsxs("div",{className:"!mt-4 md:!mt-6 !pt-4 md:!pt-6 border-t border-[#5800FF]/20 w-full",children:[e.jsx("button",{onClick:()=>K(!D),className:"text-xs md:text-sm opacity-70 hover:opacity-100 transition-opacity",children:D?"Hide Comments":`Show Comments (${c.length})`}),D&&e.jsxs("div",{className:"!mt-3 md:!mt-4 !space-y-3 md:!space-y-4 w-full",children:[c.length>0?de().map(t=>z(t)):e.jsx("p",{className:"text-xs md:text-sm opacity-60 italic",children:"No comments yet. Be the first!"}),R&&W===null&&e.jsxs("form",{onSubmit:ne,className:"!mt-4 md:!mt-6",children:[e.jsx("textarea",{ref:N,placeholder:"Write a comment...",className:"w-full !p-2 rounded border border-[#5800FF]/20 focus:border-[#5800FF] focus:ring-1 focus:ring-[#5800FF] outline-none text-sm md:text-base",rows:3,defaultValue:""}),e.jsx("button",{type:"submit",disabled:y,className:"!mt-2 !px-3 !py-1 md:!px-4 md:!py-2 bg-[#5800FF] text-white rounded hover:bg-[#E900FF] disabled:opacity-50 transition-colors text-sm md:text-base",children:y?"Posting...":"Post Comment"})]}),P&&e.jsx("div",{className:`message ${P.includes("Error")?"error":"success"} !p-2 rounded-md !mt-2 w-auto`,style:{transition:"opacity 0.5s ease-in-out"},children:P}),!R&&e.jsxs("p",{className:"text-xs md:text-sm !mt-2 md:!mt-4",children:[e.jsx(be,{href:"/login",className:"text-[#5800FF] hover:underline",children:"Sign in"})," ","to leave a comment."]})]})]})]})})]})}export{Pe as B};
