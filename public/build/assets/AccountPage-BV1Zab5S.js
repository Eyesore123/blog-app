import{u as k,j as e,f as i,q as N,b as P,a as E}from"./ConfirmationContext-_sHM_c2k.js";import{r}from"./vendor-CfxRerCp.js";import{N as A}from"./Navbar-BvdoVYAz.js";import{H as _}from"./Header-D_7cMqG9.js";import{S as R,Y as U}from"./YearFilterComponent-Ci_tXxEh.js";import{A as D,R as T,a as L}from"./RssSubscribeLink-BiM0C643.js";import{a as Y}from"./axiosInstance-tLBeUCrM.js";function $({userId:a}){const[u,p]=r.useState([]),[f,x]=r.useState(!0),[h,m]=r.useState(null),{theme:b}=k();return r.useEffect(()=>{async function s(){var t,d;try{const l=await Y.get(`/api/comments/user/${a}`);p(l.data),x(!1)}catch(l){console.error("Failed to fetch comments:",l),m(((d=(t=l.response)==null?void 0:t.data)==null?void 0:d.error)||"Failed to load comments."),x(!1)}}s()},[a]),f?e.jsx("p",{className:"text-gray-500 !mt-4",children:"Loading comments..."}):h?e.jsx("p",{className:"text-red-500 !mt-4",children:h}):e.jsxs("div",{className:"!mt-10 w-3/5 md:min-h-204",children:[e.jsx("h2",{className:"text-xl font-bold !mb-4",children:"My Comments"}),u.length===0?e.jsx("p",{className:"text-gray-500",children:"You haven't posted any comments yet."}):e.jsx("ul",{className:"!space-y-4",children:u.map(s=>e.jsxs("li",{className:"border !p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["On post:"," ",e.jsx("span",{onClick:()=>s.post_slug?i.visit(`/post/${s.post_slug}`):null,className:"text-[#5800FF] hover:underline cursor-pointer",children:s.post_title||"Unknown Post"})]}),e.jsx("p",{className:`mt-1 ${b==="dark"?"text-white":"text-black"}`,children:s.content||"No content available"}),e.jsx("p",{className:`text-xs mt-1 ${b==="dark"?"text-white":"text-gray-400"}`,children:s.created_at?new Date(s.created_at).toLocaleString():"Unknown date"})]},s.id))})]})}function G({user:a}){var y;const{props:u}=N();if(r.useEffect(()=>{(!a||a.is_anonymous)&&i.visit("/")},[a]),!a||a.is_anonymous)return null;const p=((y=u==null?void 0:u.allPosts)==null?void 0:y.data)||[],f=N().props.user,[x,h]=r.useState(f.email),[m,b]=r.useState(f.is_subscribed),[s,t]=r.useState(!1),d=r.useRef(null),l=r.useRef(null),g=r.useRef(null),{showAlert:o}=P(),{confirm:w}=E(),v=()=>{t(!0),i.post("/update-email",{email:x},{onSuccess:()=>{o("Email updated successfully!","success"),t(!1)},onError:()=>{o("Failed to update email","error"),t(!1)}})},F=()=>{const c=d.current.value??"",n=l.current.value??"",j=g.current.value??"";if(n.length<8){o("Password must be at least 8 characters long","error");return}if(n!==j){o("Passwords do not match","error");return}t(!0),i.post("/update-password",{current_password:c,password:n,password_confirmation:j},{onSuccess:()=>{o("Password updated successfully!","success"),t(!1),d.current&&(d.current.value=""),l.current&&(l.current.value=""),g.current&&(g.current.value="")},onError:()=>{o("Failed to update password","error"),t(!1)}})},C=()=>{t(!0);const c=m?"/account/unsubscribe-newsletter":"/account/subscribe-newsletter";i.post(c,{},{onSuccess:()=>{b(n=>!n),o(m?"Unsubscribed successfully!":"Subscribed successfully!","success"),t(!1)},onError:()=>{o("Failed to update subscription","error"),t(!1)}})},S=async()=>{console.log("handleDeleteAccount started");const c=await w({title:"Delete Account",message:"Are you sure you want to delete your account? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",type:"danger"});if(console.log("Delete account confirmed:",c),!c)return;const n=await w({title:"Remove Comments?",message:"Do you want to remove all your comments?",confirmText:"Yes, remove comments",cancelText:"No, keep comments",type:"warning"});console.log("Remove comments confirmed:",n),t(!0),console.log("Sending request to delete account with remove_comments:",n?"yes":"no"),i.post("/account/delete",{user_id:a.id,remove_comments:n?"yes":"no"},{onSuccess:()=>{console.log("Account deleted successfully!"),o("Account deleted successfully!","success"),t(!1),i.get("/")},onError:()=>{console.log("Failed to delete account"),o("Failed to delete account","error"),t(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsx(_,{}),e.jsx("div",{className:"min-h-160 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:e.jsx("main",{className:"!p-4 md:!p-8",children:e.jsxs("div",{className:"w-full flex flex-col items-center justify-center lg:flex-row lg:items-start md:!gap-12",children:[e.jsx("aside",{className:"w-full lg:w-120 lg:!mb-0 xl:!ml-30 2xl:!ml-40 overflow-y-auto xl:!mt-0",children:e.jsxs("div",{className:"lg:sticky lg:top-24 !space-y-4 md:!space-y-6 w-full lg:!w-80 xl:!w-100",children:[e.jsxs("div",{className:"rounded-lg !p-4",children:[e.jsx("h3",{className:"font-semibold !mb-2",children:"Account"}),e.jsx("p",{className:"opacity-80",children:"Here you can manage your account settings. You can update your email, password, and subscription status. If you don't need your account anymore, you can delete it."})]}),e.jsxs("div",{className:"rounded-lg bg-[#5800FF]/10 !p-4",children:[e.jsx(R,{posts:p}),e.jsx(U,{posts:p}),e.jsx(D,{}),e.jsx(T,{}),e.jsx(L,{})]})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center lg:flex-row lg:gap-0 w-full lg:w-2/3",children:[e.jsxs("div",{className:"flex flex-col items-center w-4/5 lg:!w-1/2 bg-[var(--bg-primary)] text-[var(--text-primary)]",children:[e.jsx("h2",{className:"text-3xl font-bold !mb-4 md:!mb-10 !mt-10 text-center",children:"My Account"}),e.jsxs("div",{className:"bg-white rounded-lg border-2 border-[#5800FF] shadow-md shadow-[#5800FF] !p-6 !space-y-4 w-full max-w-md mx-auto",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 !pb-2",children:"Name:"}),e.jsx("p",{className:"text-lg font-semibold !pb-2 text-black",children:a.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Email:"}),e.jsx("input",{type:"email",value:x,onChange:c=>h(c.target.value),className:"!mt-1 !p-4 border rounded w-full text-black"}),e.jsx("button",{onClick:v,disabled:s,className:"!mt-2 bg-[#5800FF] hover:bg-[#E900FF] text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Updating...":"Update Email"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Current Password:"}),e.jsx("input",{type:"password",ref:d,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"New Password:"}),e.jsx("input",{type:"password",ref:l,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Confirm New Password:"}),e.jsx("input",{type:"password",ref:g,className:"!mt-1 !p-2 border rounded border-gray-900 w-full text-black"}),e.jsx("button",{onClick:F,disabled:s,className:"!mt-2 bg-[#5800FF] hover:bg-[#E900FF] text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Updating...":"Update Password"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Newsletter Subscription:"}),e.jsx("button",{onClick:C,disabled:s,className:`!mt-2 ${m?"bg-red-500":"bg-green-500"} hover:opacity-80 text-white font-bold !py-2 !px-4 rounded w-full`,children:m?"Unsubscribe":"Subscribe to Newsletters"})]}),e.jsx("div",{children:e.jsx("button",{onClick:S,disabled:s,className:"!mt-6 bg-red-500 hover:bg-red-600 text-white font-bold !py-2 !px-4 rounded w-full",children:s?"Deleting...":"Delete Account"})})]})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex flex-col items-center justify-start",children:e.jsx($,{userId:a.id})})]})]})})})]})}export{G as default};
